<UserControl x:Class="otor.msixhero.ui.Modules.Common.PackageContent.View.PackageContentView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:helpers="clr-namespace:otor.msixhero.ui.Helpers"
             xmlns:mvvm="http://prismlibrary.com/"
             xmlns:progressOverlay="clr-namespace:otor.msixhero.ui.Controls.ProgressOverlay"
             xmlns:descriptor="clr-namespace:otor.msixhero.lib.Domain.Appx.Psf.Descriptor;assembly=msixhero.lib"
             xmlns:system="clr-namespace:System;assembly=System.Runtime"
             xmlns:routedCommand="clr-namespace:otor.msixhero.ui.Commands.RoutedCommand"
             xmlns:zeroOrAny="clr-namespace:otor.msixhero.ui.Controls.ZeroOrAny"
             xmlns:msixHeroText="clr-namespace:otor.msixhero.ui.Controls.MsixHeroText"
             xmlns:view="clr-namespace:otor.msixhero.ui.Modules.Common.PackageContent.View"
             xmlns:psf="clr-namespace:otor.msixhero.ui.Modules.Common.PackageContent.ViewModel.Elements.Psf"
             xmlns:elements1="clr-namespace:otor.msixhero.ui.Modules.Common.PackageContent.ViewModel.Elements"
             xmlns:viewModel="clr-namespace:otor.msixhero.ui.Modules.Common.PackageContent.ViewModel"
             xmlns:controls="clr-namespace:otor.msixhero.ui.Controls"
             xmlns:packageHeader="clr-namespace:otor.msixhero.ui.Controls.PackageHeader"
             xmlns:view1="clr-namespace:otor.msixhero.ui.Modules.Common.PsfContent.View"
             mvvm:ViewModelLocator.AutoWireViewModel="True"
             mc:Ignorable="d" 
             d:DataContext="{d:DesignInstance viewModel:PackageContentViewModel}"
             d:DesignHeight="450" d:DesignWidth="800">
    <UserControl.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/msixhero;component/Themes/Colors.xaml" />
                <ResourceDictionary Source="/msixhero;component/Themes/Converters.xaml" />
                <ResourceDictionary Source="/msixhero;component/Themes/Tabs.xaml" />
                <ResourceDictionary Source="/msixhero;component/Themes/Generic.xaml" />
            </ResourceDictionary.MergedDictionaries>

            <Style TargetType="view:BulletItemControl">
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="view:BulletItemControl">
                            <DockPanel>
                                <Border Width="32" Height="32" VerticalAlignment="Top" HorizontalAlignment="Center" Margin="0 0 0 10">
                                    <ContentPresenter Width="32" Content="{TemplateBinding Header}" VerticalAlignment="Center" HorizontalAlignment="Center" />
                                </Border>

                                <Border Width="1" SnapsToDevicePixels="True" UseLayoutRounding="True" VerticalAlignment="Stretch" Background="#DDD" Margin="10 0" />

                                <StackPanel IsItemsHost="True" Margin="0 0 0 10" />
                            </DockPanel>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

            <Style TargetType="Path" x:Key="Icon">
                <Setter Property="Width" Value="32" />
                <Setter Property="Height" Value="32" />
                <Setter Property="Fill" Value="#999" />
            </Style>

            <BitmapImage x:Key="DummyLogo" UriSource="icons8-sugar-cube-64.png" />
        </ResourceDictionary>
    </UserControl.Resources>
    <routedCommand:RoutedCommandHandlers.Commands>
        <routedCommand:RoutedCommandHandler RoutedCommand="{x:Static psf:AppxPsfViewModel.EditScript}" Command="{Binding CommandHandler.EditScript}" />
    </routedCommand:RoutedCommandHandlers.Commands>

    <progressOverlay:ProgressOverlay IsShown="{Binding SelectedPackageManifestInfo.IsLoading}" Margin="-5">
        <DockPanel Margin="5 5 0 0">
            <packageHeader:PackageHeader
                Visibility="{Binding HasError, Converter={StaticResource NegativeBooleanToVisibilityConverter}}"
                DataContext="{Binding SelectedPackageManifestInfo}"
                Publisher="{Binding CurrentValue.PublisherDisplayName}" 
                Version="{Binding CurrentValue.Version}"
                PackageName="{Binding CurrentValue.DisplayName}" 
                Logo="{Binding CurrentValue.Logo, TargetNullValue={StaticResource DummyLogo}, FallbackValue={StaticResource DummyLogo}}" 
                TileColor="{Binding CurrentValue.TileColor, TargetNullValue={x:Static Brushes.Gray}, FallbackValue={x:Static Brushes.Gray}}"
                DockPanel.Dock="Top" Margin="-5 -5 0 0" />

            <!--
            <Border Height="31" Margin="0 0 0 -11" DockPanel.Dock="Top" Visibility="{Binding SelectedPackageManifestInfo.HasError, Converter={StaticResource NegativeBooleanToVisibilityConverter}}">
                <Label VerticalAlignment="Center" Style="{StaticResource Label}" Content="{Binding SelectedPackageManifestInfo.CurrentValue.DisplayName}" />
            </Border>-->

            <Border VerticalAlignment="Center" HorizontalAlignment="Center" DockPanel.Dock="Top" Background="IndianRed" Padding="10" Visibility="{Binding SelectedPackageManifestInfo.HasError, Converter={StaticResource BooleanToVisibilityConverter}}">
                <TextBlock Text="{Binding SelectedPackageManifestInfo.Error}" Foreground="White" TextWrapping="Wrap" Margin="12 6" />
            </Border>

            <TabControl DockPanel.Dock="Top" Margin="0 0 0 0" Visibility="{Binding SelectedPackageManifestInfo.HasError, Converter={StaticResource NegativeBooleanToVisibilityConverter}}">
                <TabItem Header="Properties">
                    <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                        <StackPanel>
                            <StackPanel DataContext="{Binding SelectedPackageManifestInfo.CurrentValue}">
                                <!--<DockPanel DockPanel.Dock="Top" >

                                    <Border Margin="0 0 0 10" Background="#CCFFD1" DockPanel.Dock="Top" Padding="10" Visibility="{Binding IsProvisioned, Converter={StaticResource BooleanToVisibilityConverter}}">
                                        <TextBlock Text="This is a provisioned package" Foreground="DarkGreen" TextAlignment="Left" TextWrapping="Wrap" />
                                    </Border>

                                    <Border Background="#2B579A" Width="64" Height="64" VerticalAlignment="Center" HorizontalAlignment="Left">
                                        <Border Background="{Binding TileColor}" Width="64" Height="64" VerticalAlignment="Center" HorizontalAlignment="Left">
                                            <Image Source="{Binding Logo}" VerticalAlignment="Center" HorizontalAlignment="Center" MaxWidth="48" MaxHeight="48" Stretch="Uniform" StretchDirection="DownOnly" />
                                        </Border>
                                    </Border>
                                    <TextBlock TextWrapping="Wrap" Text="{Binding Description}" Margin="10 0 0 0" VerticalAlignment="Center" />
                                </DockPanel>-->

                                <StackPanel Margin="0 10 0 0">
                                    <TextBlock Style="{StaticResource DataHeader}" Text="Description" />
                                    <TextBox Style="{StaticResource DataValueTextBlock}" Text="{Binding Description, Mode=OneWay, TargetNullValue='None', FallbackValue='None'}" TextWrapping="Wrap" />
                                </StackPanel>

                                <!--<StackPanel Margin="0 10 0 0">
                                    <TextBlock Style="{StaticResource DataHeader}" Text="Version" />
                                    <TextBox Style="{StaticResource DataValueTextBlock}" Text="{Binding Version, Mode=OneWay}" TextWrapping="Wrap" />
                                </StackPanel>

                                <StackPanel Margin="0 10 0 0">
                                    <TextBlock Style="{StaticResource DataHeader}" Text="Publisher name" />
                                    <TextBox Style="{StaticResource DataValueTextBlock}" Text="{Binding PublisherDisplayName, Mode=OneWay}" TextWrapping="Wrap" />
                                </StackPanel>

                                <StackPanel Margin="0 10 0 0">
                                    <TextBlock Style="{StaticResource DataHeader}" Text="Installed on" />
                                    <TextBlock Style="{StaticResource DataValue}" Text="{Binding InstallDate}" TextWrapping="Wrap" />
                                </StackPanel>-->

                                <StackPanel Margin="0 10 0 0">
                                    <TextBlock Style="{StaticResource DataHeader}" Text="Publisher" />
                                    <TextBox Style="{StaticResource DataValueTextBlock}" Text="{Binding Publisher, Mode=OneWay}" TextWrapping="Wrap" />
                                </StackPanel>

                                <StackPanel Margin="0 10 0 0">
                                    <TextBlock Style="{StaticResource DataHeader}" Text="Family name" />
                                    <TextBox Style="{StaticResource DataValueTextBlock}" Text="{Binding Path=FamilyName, Mode=OneWay}" TextWrapping="Wrap" />
                                </StackPanel>

                                <StackPanel Margin="0 10 0 0">
                                    <TextBlock Style="{StaticResource DataHeader}" Text="Full package name" />
                                    <TextBox Style="{StaticResource DataValueTextBlock}" Text="{Binding Path=PackageFullName, Mode=OneWay}" TextWrapping="Wrap" />
                                </StackPanel>
                            </StackPanel>
                            <StackPanel Margin="0 10 0 0" Visibility="{Binding SelectedPackageManifestInfo.CurrentValue.HasBuildInfo, Converter={StaticResource BooleanToVisibilityConverter}}">
                                <TextBlock Style="{StaticResource DataHeader}" Text="Packaging environment" />
                                <TextBlock Style="{StaticResource DataValue}" Margin="0">
                                    <Run Text="{Binding SelectedPackageManifestInfo.CurrentValue.BuildInfo.ProductName, Mode=OneWay, TargetNullValue='Unknown product'}" />
                                    <Run Text="{Binding SelectedPackageManifestInfo.CurrentValue.BuildInfo.ProductVersion, Mode=OneWay}" />
                                </TextBlock>
                                <TextBlock Style="{StaticResource DataValue}" Text="{Binding SelectedPackageManifestInfo.CurrentValue.BuildInfo.OperatingSystem, TargetNullValue='Unknown Operating System'}" />
                            </StackPanel>
                        </StackPanel>
                    </ScrollViewer>
                </TabItem>
                <TabItem Header="Content" Visibility="{Binding SelectedPackageManifestInfo.HasError, Converter={StaticResource NegativeBooleanToVisibilityConverter}}">
                    <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                        <zeroOrAny:ZeroOrAny ItemsCount="{Binding SelectedPackageManifestInfo.CurrentValue.Applications.Count}">
                            <zeroOrAny:ZeroOrAny.Template>
                                <ControlTemplate TargetType="zeroOrAny:ZeroOrAny">
                                    <ContentControl Content="{Binding}" ContentTemplate="{TemplateBinding ActualTemplate}" />
                                </ControlTemplate>
                            </zeroOrAny:ZeroOrAny.Template>
                            <zeroOrAny:ZeroOrAny.AnyItemTemplate>
                                <DataTemplate>
                                    <DataTemplate.Resources>
                                        <system:Boolean x:Key="True">True</system:Boolean>
                                        <system:Boolean x:Key="False">False</system:Boolean>
                                    </DataTemplate.Resources>
                                    <ItemsControl ItemsSource="{Binding SelectedPackageManifestInfo.CurrentValue.Applications}">
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate DataType="{x:Type elements1:AppxApplicationViewModel}">
                                                <StackPanel Margin="0 0 0 24">
                                                    <view:BulletItemControl>
                                                        <view:BulletItemControl.Header>
                                                            <Border Background="#2B579A" Width="32" Height="32" VerticalAlignment="Top" HorizontalAlignment="Center">
                                                                <Border Background="{Binding TileColor}" Width="32" Height="32" VerticalAlignment="Center" HorizontalAlignment="Left">
                                                                    <Image Source="{Binding Image}" VerticalAlignment="Center" HorizontalAlignment="Center" MaxWidth="48" MaxHeight="48" Stretch="Uniform" StretchDirection="DownOnly" />
                                                                </Border>
                                                            </Border>
                                                        </view:BulletItemControl.Header>
                                                        <Border MinHeight="32">
                                                            <StackPanel VerticalAlignment="Center" Margin="0 2">
                                                                <TextBlock Text="{Binding DisplayName, Mode=OneTime}" />
                                                                <TextBlock Text="{Binding DisplayType, Mode=OneTime}" />
                                                            </StackPanel>
                                                        </Border>
                                                    </view:BulletItemControl>

                                                    <view:BulletItemControl>
                                                        <view:BulletItemControl.Header>
                                                            <Viewbox Width="24" Height="24">
                                                                <Path Style="{StaticResource Icon}" Data="{StaticResource VectorShortcut}" />
                                                            </Viewbox>
                                                        </view:BulletItemControl.Header>

                                                        <TextBlock Style="{StaticResource DataHeader}" Text="Target" />
                                                        <TextBlock Style="{StaticResource DataValue}" Visibility="{Binding HasPsf, Mode=OneTime, Converter={StaticResource NegativeBooleanToVisibilityConverter}}" Text="{Binding Start, Mode=OneTime}" TextWrapping="Wrap" />
                                                        <TextBlock Style="{StaticResource DataValue}" Visibility="{Binding HasPsf, Mode=OneTime, Converter={StaticResource BooleanToVisibilityConverter}}" TextWrapping="Wrap">
                                                                        <Run Text="{Binding Psf.Executable, Mode=OneTime}" />
                                                                        <Run Text="(launched by " Foreground="#777" /><Run Foreground="#777" Text="{Binding Start, Mode=OneWay}" /><Run Foreground="#777" Text=")" />
                                                        </TextBlock>
                                                    </view:BulletItemControl>

                                                    <view:BulletItemControl x:Name="EntryPoint">
                                                        <view:BulletItemControl.Header>
                                                            <Viewbox Width="24" Height="24">
                                                                <Path Style="{StaticResource Icon}" Data="{StaticResource VectorBulb}" />
                                                            </Viewbox>
                                                        </view:BulletItemControl.Header>

                                                        <TextBlock Style="{StaticResource DataHeader}" Text="Entry point" />
                                                        <TextBlock Style="{StaticResource DataValue}" Text="{Binding EntryPoint, Mode=OneTime}" TextWrapping="Wrap" />
                                                    </view:BulletItemControl>

                                                    <view:BulletItemControl x:Name="Arguments">
                                                        <view:BulletItemControl.Header>
                                                            <Viewbox Width="24" Height="24">
                                                                <Path Style="{StaticResource Icon}" Data="{StaticResource VectorConsole}" />
                                                            </Viewbox>
                                                        </view:BulletItemControl.Header>

                                                        <TextBlock Style="{StaticResource DataHeader}" Text="Command line arguments" />
                                                        <TextBox Style="{StaticResource DataValueTextBlock}" Text="{Binding Psf.Arguments, Mode=OneTime}" TextWrapping="Wrap" />
                                                    </view:BulletItemControl>

                                                    <view:BulletItemControl x:Name="WorkingDirectory">
                                                        <view:BulletItemControl.Header>
                                                            <Viewbox Width="24" Height="24">
                                                                <Path Style="{StaticResource Icon}" Data="{StaticResource VectorOpen}" />
                                                            </Viewbox>
                                                        </view:BulletItemControl.Header>

                                                        <TextBlock Style="{StaticResource DataHeader}" Text="Working directory" />
                                                        <TextBlock Style="{StaticResource DataValue}" Text="{Binding Psf.WorkingDirectory}" TextWrapping="Wrap" />
                                                    </view:BulletItemControl>

                                                    <view:BulletItemControl x:Name="AppListEntry">
                                                        <view:BulletItemControl.Header>
                                                            <Viewbox Width="24" Height="24">
                                                                <Path Style="{StaticResource Icon}" Data="{StaticResource VectorStartMenu}" />
                                                            </Viewbox>
                                                        </view:BulletItemControl.Header>

                                                        <TextBlock Style="{StaticResource DataHeader}" Text="App list entry" />
                                                        <TextBlock x:Name="AppListEntryText" Style="{StaticResource DataValue}" Text="Visible" TextWrapping="Wrap" />
                                                    </view:BulletItemControl>

                                                    <Border x:Name="HeaderFixups" Visibility="Collapsed">
                                                        <StackPanel>
                                                            <Border BorderBrush="#ddd" SnapsToDevicePixels="True" UseLayoutRounding="True" BorderThickness="1" CornerRadius="5" HorizontalAlignment="Left">
                                                                <TextBlock Text="PSF FIXUPS" Margin="10 5" FontWeight="SemiBold" Foreground="#444" />
                                                            </Border>
                                                            <view:BulletItemControl Height="10" />
                                                        </StackPanel>
                                                    </Border>

                                                    <view:BulletItemControl x:Name="Tracing">
                                                        <view:BulletItemControl.Header>
                                                            <Viewbox Width="24" Height="24">
                                                                <Path Style="{StaticResource Icon}" Data="M 24 0 L 21.714844 4 L 6 4 L 6 9 L 5 9 L 5 11 L 8 11 L 8 10 L 8 9 L 8 6 L 20.572266 6 L 16 14 L 24 14 L 24 16 C 19.6 16 16 19.6 16 24 C 16 24.691044 16.098874 25.35927 16.265625 26 L 8 26 L 8 22 L 6 22 L 6 28 L 17.087891 28 C 18.477015 30.384094 21.05638 32 24 32 C 28.4 32 32 28.4 32 24 C 32 20.291044 29.438915 17.160607 26 16.265625 L 26 14 L 32 14 L 24 0 z M 23 5 L 25 5 L 25.03125 9 L 23 9 L 23 5 z M 23 10 L 25 10 L 25 12 L 23 12 L 23 10 z M 6 12 L 6 14 L 5 14 L 5 16 L 8 16 L 8 14 L 8 12 L 6 12 z M 6 17 L 6 19 L 5 19 L 5 21 L 8 21 L 8 19 L 8 17 L 6 17 z M 24 18 C 27.3 18 30 20.7 30 24 C 30 27.3 27.3 30 24 30 C 20.7 30 18 27.3 18 24 C 18 20.7 20.7 18 24 18 z M 21.699219 20.300781 L 20.300781 21.699219 L 22.599609 24 L 20.300781 26.300781 L 21.699219 27.699219 L 24 25.400391 L 26.300781 27.699219 L 27.699219 26.300781 L 25.400391 24 L 27.699219 21.699219 L 26.300781 20.300781 L 24 22.599609 L 21.699219 20.300781 z" />
                                                            </Viewbox>
                                                        </view:BulletItemControl.Header>

                                                        <TextBlock Style="{StaticResource DataHeader}" Text="Enable tracing (fix-up)" />
                                                        <TextBlock Style="{StaticResource DataValue}" TextWrapping="Wrap">
                                                                        <Run Text="Break on:" />
                                                                        <Run Text="{Binding Psf.Tracing.BreaksOn, Mode=OneWay}" />
                                                        </TextBlock>
                                                    </view:BulletItemControl>

                                                    <ItemsControl Visibility="Collapsed" x:Name="FileRedirections" ItemsSource="{Binding Psf.FileRedirections, Mode=OneWay}">
                                                        <ItemsControl.ItemTemplate>
                                                            <DataTemplate DataType="{x:Type descriptor:PsfFolderRedirectionDescriptor}">
                                                                <view:BulletItemControl>
                                                                    <view:BulletItemControl.Header>
                                                                        <Viewbox Width="24" Height="24">
                                                                            <Path Style="{StaticResource Icon}" Data="M 6 3 L 6 19.738281 L 6.2265625 19.990234 C 6.2425625 20.008234 6.906 20.724375 8 21.609375 L 8 5 L 18 5 L 18 11 L 24 11 L 24 18 L 26 18 L 26 9.5859375 L 19.414062 3 L 6 3 z M 20 6.4140625 L 22.585938 9 L 20 9 L 20 6.4140625 z M 23 20 L 23 22 L 25.6875 22 C 24.572279 23.304175 21.006174 27 16 27 C 9.9765914 27 4.7441406 21.332031 4.7441406 21.332031 L 3.2558594 22.667969 C 3.2558594 22.667969 8.7694086 29 16 29 C 21.451867 29 25.389563 25.361343 27 23.568359 L 27 26 L 29 26 L 29 20 L 23 20 z" />
                                                                        </Viewbox>
                                                                    </view:BulletItemControl.Header>

                                                                    <TextBlock Style="{StaticResource DataHeader}" Text="Redirect files from folder (fix-up)" />
                                                                    <TextBlock Style="{StaticResource DataValue}" TextWrapping="Wrap" Text="{Binding Directory}" />

                                                                    <Border BorderBrush="#ccc" Margin="32 0 0 16">
                                                                        <StackPanel>
                                                                            <TextBlock Margin="6 0 0 0" x:Name="Inc0" Opacity="0.7" Text="...matching the following conditions:" />
                                                                            <ItemsControl Margin="16 0 0 6" x:Name="Inc1" ItemsSource="{Binding Inclusions}">
                                                                                <ItemsControl.ItemTemplate>
                                                                                    <DataTemplate DataType="{x:Type descriptor:PsfFileRedirectionDescriptor}">
                                                                                        <DockPanel VerticalAlignment="Center">
                                                                                            <TextBlock x:Name="txt" ToolTip="{Binding RegularExpression}" Text="{Binding DisplayName, StringFormat='{}&#x2022; {0}'}" VerticalAlignment="Center" />
                                                                                        </DockPanel>
                                                                                        <DataTemplate.Triggers>
                                                                                            <DataTrigger Binding="{Binding DisplayName}" Value="{x:Null}">
                                                                                                <Setter TargetName="txt" Property="Text" Value="{Binding RegularExpression, StringFormat='{}&#x2022; {0}'}" />
                                                                                                <Setter TargetName="txt" Property="ToolTip" Value="{x:Null}" />
                                                                                            </DataTrigger>
                                                                                        </DataTemplate.Triggers>
                                                                                    </DataTemplate>
                                                                                </ItemsControl.ItemTemplate>
                                                                            </ItemsControl>

                                                                            <TextBlock Margin="6 0 0 0" x:Name="Exc0" Opacity="0.7" Text="...but excluding:" />
                                                                            <ItemsControl Margin="16 0 0 6" x:Name="Exc1" ItemsSource="{Binding Exclusions}">
                                                                                <ItemsControl.ItemTemplate>
                                                                                    <DataTemplate DataType="{x:Type descriptor:PsfFileRedirectionDescriptor}">
                                                                                        <TextBlock x:Name="txt" ToolTip="{Binding RegularExpression}" Text="{Binding DisplayName, StringFormat='{}&#x2022; {0}'}" />
                                                                                        <DataTemplate.Triggers>
                                                                                            <DataTrigger Binding="{Binding DisplayName}" Value="{x:Null}">
                                                                                                <Setter TargetName="txt" Property="Text" Value="{Binding RegularExpression, StringFormat='{}&#x2022; {0}'}" />
                                                                                                <Setter TargetName="txt" Property="ToolTip" Value="{x:Null}" />
                                                                                            </DataTrigger>
                                                                                        </DataTemplate.Triggers>
                                                                                    </DataTemplate>
                                                                                </ItemsControl.ItemTemplate>
                                                                            </ItemsControl>
                                                                        </StackPanel>
                                                                    </Border>

                                                                </view:BulletItemControl>

                                                                <DataTemplate.Resources>
                                                                    <system:Int32 x:Key="Int0">0</system:Int32>
                                                                </DataTemplate.Resources>
                                                                <DataTemplate.Triggers>
                                                                    <DataTrigger Binding="{Binding Path=Inclusions.Count}" Value="{StaticResource Int0}">
                                                                        <Setter Property="Visibility" TargetName="Inc0" Value="Collapsed" />
                                                                        <Setter Property="Visibility" TargetName="Inc1" Value="Collapsed" />
                                                                    </DataTrigger>
                                                                    <DataTrigger Binding="{Binding Path=Exclusions.Count}" Value="{StaticResource Int0}">
                                                                        <Setter Property="Visibility" TargetName="Exc0" Value="Collapsed" />
                                                                        <Setter Property="Visibility" TargetName="Exc1" Value="Collapsed" />
                                                                    </DataTrigger>
                                                                </DataTemplate.Triggers>
                                                            </DataTemplate>
                                                        </ItemsControl.ItemTemplate>
                                                    </ItemsControl>

                                                    <Border x:Name="HeaderScripts" Visibility="Collapsed">
                                                        <StackPanel>
                                                            <Border BorderBrush="#ddd" SnapsToDevicePixels="True" UseLayoutRounding="True" BorderThickness="1" CornerRadius="5" HorizontalAlignment="Left">
                                                                <TextBlock Text="POWERSHELL SCRIPTS" Margin="10 5" FontWeight="SemiBold" Foreground="#444" />
                                                            </Border>
                                                            <view:BulletItemControl Height="10" />
                                                        </StackPanel>
                                                    </Border>

                                                    <ItemsControl x:Name="Scripts" ItemsSource="{Binding Psf.Scripts, Mode=OneWay}">
                                                        <ItemsControl.ItemTemplate>
                                                            <DataTemplate DataType="{x:Type psf:AppxPsfScriptViewModel}">
                                                                <view:BulletItemControl>
                                                                    <view:BulletItemControl.Header>
                                                                        <Viewbox Width="24" Height="24">
                                                                            <Path Style="{StaticResource Icon}" Data="{StaticResource VectorPowerShell}" />
                                                                        </Viewbox>
                                                                    </view:BulletItemControl.Header>

                                                                    <TextBlock Style="{StaticResource DataHeader}" x:Name="Header" Text="Before the application starts" />
                                                                    <TextBlock Style="{StaticResource DataValue}" TextWrapping="Wrap">
                                                                        <Run x:Name="Caption2" Text="Start" />
                                                                        <Hyperlink Command="{x:Static psf:AppxPsfViewModel.EditScript}" CommandParameter="{Binding}">
                                                                            <Run Text="{Binding Name, Mode=OneWay}" />
                                                                        </Hyperlink>
                                                                    </TextBlock>

                                                                    <DockPanel Margin="32 0 0 0" VerticalAlignment="Center" Visibility="{Binding HasArguments, Converter={StaticResource BooleanToVisibilityConverter}}">
                                                                        <TextBlock Text="&#x2022; Arguments: " VerticalAlignment="Center" />
                                                                        <TextBlock Text="{Binding Arguments, Mode=OneWay}" TextWrapping="Wrap" VerticalAlignment="Center" />
                                                                    </DockPanel>

                                                                    <TextBlock Margin="32 0 0 0" Visibility="{Binding OnlyOnce, Converter={StaticResource BooleanToVisibilityConverter}}" Text="&#x2022; Run only once" VerticalAlignment="Center" />
                                                                    <TextBlock Margin="32 0 0 0" Visibility="{Binding OnlyOnce, Converter={StaticResource NegativeBooleanToVisibilityConverter}}" Text="&#x2022; Run always" VerticalAlignment="Center" />

                                                                    <TextBlock Margin="32 0 0 0" Visibility="{Binding InVirtualEnvironment, Converter={StaticResource BooleanToVisibilityConverter}}" Text="&#x2022; Run in a virtual environment" VerticalAlignment="Center" />
                                                                    <TextBlock Margin="32 0 0 0" Visibility="{Binding InVirtualEnvironment, Converter={StaticResource NegativeBooleanToVisibilityConverter}}" Text="&#x2022; Run outside of the virtual environment" VerticalAlignment="Center" />

                                                                    <TextBlock Margin="32 0 0 0" Visibility="{Binding ShowWindow, Converter={StaticResource BooleanToVisibilityConverter}}" Text="&#x2022; Show window" VerticalAlignment="Center" />
                                                                    <TextBlock Margin="32 0 0 0" Visibility="{Binding ShowWindow, Converter={StaticResource NegativeBooleanToVisibilityConverter}}" Text="&#x2022; Show no window" VerticalAlignment="Center" />

                                                                    <TextBlock Margin="32 0 0 0" Visibility="{Binding WaitForFinish, Converter={StaticResource BooleanToVisibilityConverter}}" Text="&#x2022; Wait for finish" VerticalAlignment="Center" />
                                                                    <TextBlock Margin="32 0 0 0" Visibility="{Binding WaitForFinish, Converter={StaticResource NegativeBooleanToVisibilityConverter}}" Text="&#x2022; Run asynchronously" VerticalAlignment="Center" />
                                                                </view:BulletItemControl>
                                                                <DataTemplate.Triggers>
                                                                    <DataTrigger Binding="{Binding Timing}" Value="{x:Static descriptor:PsfScriptDescriptorTiming.Finish}">
                                                                        <Setter TargetName="Header" Property="Text" Value="After the application finishes" />
                                                                    </DataTrigger>
                                                                </DataTemplate.Triggers>
                                                            </DataTemplate>
                                                        </ItemsControl.ItemTemplate>
                                                    </ItemsControl>

                                                </StackPanel>
                                                <DataTemplate.Triggers>
                                                    <DataTrigger Binding="{Binding HasPsf}" Value="{StaticResource False}">
                                                        <Setter TargetName="WorkingDirectory" Property="Visibility" Value="Collapsed" />
                                                        <Setter TargetName="Arguments" Property="Visibility" Value="Collapsed" />
                                                        <Setter TargetName="Tracing" Property="Visibility" Value="Collapsed" />
                                                        <Setter TargetName="FileRedirections" Property="Visibility" Value="Collapsed" />
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding Psf}" Value="{x:Null}">
                                                        <Setter TargetName="WorkingDirectory" Property="Visibility" Value="Collapsed" />
                                                        <Setter TargetName="Arguments" Property="Visibility" Value="Collapsed" />
                                                        <Setter TargetName="Tracing" Property="Visibility" Value="Collapsed" />
                                                        <Setter TargetName="FileRedirections" Property="Visibility" Value="Collapsed" />
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding Psf.HasWorkingDirectory}" Value="{StaticResource False}">
                                                        <Setter TargetName="WorkingDirectory" Property="Visibility" Value="Collapsed" />
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding Psf.HasArguments}" Value="{StaticResource False}">
                                                        <Setter TargetName="Arguments" Property="Visibility" Value="Collapsed" />
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding Psf.HasTracing}" Value="{StaticResource False}">
                                                        <Setter TargetName="Tracing" Property="Visibility" Value="Collapsed" />
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding Psf.HasFileRedirections}" Value="{StaticResource False}">
                                                        <Setter TargetName="FileRedirections" Property="Visibility" Value="Collapsed" />
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding HasEntryPoint}" Value="{StaticResource False}">
                                                        <Setter TargetName="EntryPoint" Property="Visibility" Value="Collapsed" />
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding Visible}" Value="{StaticResource False}">
                                                        <Setter TargetName="AppListEntryText" Property="Text" Value="Hidden" />
                                                    </DataTrigger>
                                                    <MultiDataTrigger>
                                                        <MultiDataTrigger.Conditions>
                                                            <Condition Binding="{Binding HasPsf}" Value="{StaticResource True}" />
                                                            <Condition Binding="{Binding Psf.HasFileRedirections}" Value="{StaticResource True}" />
                                                        </MultiDataTrigger.Conditions>
                                                        <MultiDataTrigger.Setters>
                                                            <Setter TargetName="HeaderFixups" Property="Visibility" Value="Visible" />
                                                        </MultiDataTrigger.Setters>
                                                    </MultiDataTrigger>
                                                    <MultiDataTrigger>
                                                        <MultiDataTrigger.Conditions>
                                                            <Condition Binding="{Binding HasPsf}" Value="{StaticResource True}" />
                                                            <Condition Binding="{Binding Psf.HasTracing}" Value="{StaticResource True}" />
                                                        </MultiDataTrigger.Conditions>
                                                        <MultiDataTrigger.Setters>
                                                            <Setter TargetName="HeaderFixups" Property="Visibility" Value="Visible" />
                                                        </MultiDataTrigger.Setters>
                                                    </MultiDataTrigger>
                                                    <MultiDataTrigger>
                                                        <MultiDataTrigger.Conditions>
                                                            <Condition Binding="{Binding HasPsf}" Value="{StaticResource True}" />
                                                            <Condition Binding="{Binding Psf.HasScripts}" Value="{StaticResource True}" />
                                                        </MultiDataTrigger.Conditions>
                                                        <MultiDataTrigger.Setters>
                                                            <Setter TargetName="HeaderScripts" Property="Visibility" Value="Visible" />
                                                        </MultiDataTrigger.Setters>
                                                    </MultiDataTrigger>
                                                    <DataTrigger Binding="{Binding Visible}" Value="{StaticResource False}">
                                                        <Setter TargetName="AppListEntryText" Property="Text" Value="Hidden" />
                                                    </DataTrigger>
                                                </DataTemplate.Triggers>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </DataTemplate>
                            </zeroOrAny:ZeroOrAny.AnyItemTemplate>
                            <zeroOrAny:ZeroOrAny.NoItemsTemplate>
                                <DataTemplate>
                                    <msixHeroText:MsixHeroText VerticalAlignment="Center" Tag="This package does not define applications." />
                                </DataTemplate>
                            </zeroOrAny:ZeroOrAny.NoItemsTemplate>
                        </zeroOrAny:ZeroOrAny>
                    </ScrollViewer>

                </TabItem>
                <TabItem Header="PSF" Tag="{Binding SelectedPackageJsonInfo.CurrentValue, TargetNullValue={x:Null}, FallbackValue={x:Null}}">
                    <TabItem.Style>
                        <Style TargetType="TabItem" BasedOn="{StaticResource {x:Type TabItem}}">
                            <Style.Triggers>
                                <Trigger Property="Tag" Value="{x:Null}">
                                    <Setter Property="IsEnabled" Value="False" />
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </TabItem.Style>
                    <progressOverlay:ProgressOverlay IsShown="{Binding SelectedPackageJsonInfo.IsLoading}">
                        <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                            <view1:PsfContentView IsEnabled="False" DataContext="{Binding SelectedPackageJsonInfo.CurrentValue}" />
                        </ScrollViewer>
                    </progressOverlay:ProgressOverlay>
                </TabItem>
                <TabItem Visibility="{Binding SelectedPackageManifestInfo.HasError, Converter={StaticResource NegativeBooleanToVisibilityConverter}}">
                    <TabItem.Header>
                        <TextBlock>
                        <Run FontSize="13" Text="Dependencies" />
                        <!--<Run Text="{Binding SelectedPackageManifestInfo.CurrentValue.PackageDependencies.Count, Mode=OneWay}"  Foreground="#777" />-->
                        </TextBlock>
                    </TabItem.Header>
                    <progressOverlay:ProgressOverlay IsShown="{Binding SelectedPackageManifestInfo.IsLoading}">
                        <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                            <StackPanel Margin="0">
                                <Border DockPanel.Dock="Top" Visibility="{Binding SelectedPackageManifestInfo.CurrentValue.HasOperatingSystemDependencies, Converter={StaticResource BooleanToVisibilityConverter}, FallbackValue={x:Static Visibility.Visible}}">
                                    <StackPanel>
                                        <Border BorderBrush="#ddd" SnapsToDevicePixels="True" UseLayoutRounding="True" BorderThickness="1" CornerRadius="5" HorizontalAlignment="Left">
                                            <TextBlock Text="DEVICE FAMILIES" Margin="10 5" FontWeight="SemiBold" Foreground="#444" />
                                        </Border>
                                        <view:BulletItemControl Height="10" />
                                    </StackPanel>
                                </Border>

                                <ItemsControl DockPanel.Dock="Top" ItemsSource="{Binding SelectedPackageManifestInfo.CurrentValue.OperatingSystemDependencies}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate DataType="{x:Type elements1:OperatingSystemDependencyViewModel}">
                                            <StackPanel>
                                                <view:BulletItemControl>
                                                    <view:BulletItemControl.Header>
                                                        <Viewbox Width="24" Height="24">
                                                            <Path Style="{StaticResource Icon}" Data="{StaticResource VectorWindows}" />
                                                        </Viewbox>
                                                    </view:BulletItemControl.Header>
                                                    <TextBlock Style="{StaticResource DataHeader}" Visibility="{Binding HasMinimumVersion, Converter={StaticResource BooleanToVisibilityConverter}}" Text="Minimum required OS" />
                                                    <TextBlock Style="{StaticResource DataValue}" Visibility="{Binding HasMinimumVersion, Converter={StaticResource BooleanToVisibilityConverter}}">
                                                    <Run Text="{Binding Path=MinimumDisplayName , Mode=OneWay}" />
                                                    <Run Text="{Binding Path=MinimumVersion, Mode=OneWay}" Foreground="#b2b2b2" />
                                                    </TextBlock>
                                                </view:BulletItemControl>
                                                <view:BulletItemControl>
                                                    <view:BulletItemControl.Header>
                                                        <Viewbox Width="24" Height="24">
                                                            <Path Style="{StaticResource Icon}" Data="{StaticResource VectorWindows}" />
                                                        </Viewbox>
                                                    </view:BulletItemControl.Header>
                                                    <TextBlock Style="{StaticResource DataHeader}" Visibility="{Binding HasTestedVersion, Converter={StaticResource BooleanToVisibilityConverter}}" Text="Tested on" />
                                                    <TextBlock Style="{StaticResource DataValue}" Visibility="{Binding HasTestedVersion, Converter={StaticResource BooleanToVisibilityConverter}}">
                                                    <Run Text="{Binding Path=TestedDisplayName , Mode=OneWay}" />
                                                    <Run Text="{Binding Path=TestedVersion, Mode=OneWay}" Foreground="#b2b2b2" />
                                                    </TextBlock>
                                                </view:BulletItemControl>
                                            </StackPanel>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>

                                <Border Visibility="{Binding SelectedPackageManifestInfo.CurrentValue.HasPackageDependencies, Converter={StaticResource BooleanToVisibilityConverter}, FallbackValue={x:Static Visibility.Visible}}">
                                    <StackPanel>
                                        <Border BorderBrush="#ddd" SnapsToDevicePixels="True" UseLayoutRounding="True" BorderThickness="1" CornerRadius="5" HorizontalAlignment="Left">
                                            <TextBlock Text="PACKAGE DEPENDENCIES" Margin="10 5" FontWeight="SemiBold" Foreground="#444" />
                                        </Border>
                                        <view:BulletItemControl Height="10" />
                                    </StackPanel>
                                </Border>

                                <ItemsControl ItemsSource="{Binding SelectedPackageManifestInfo.CurrentValue.PackageDependencies}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate DataType="{x:Type elements1:PackageDependencyViewModel}">

                                            <view:BulletItemControl>
                                                <view:BulletItemControl.Header>
                                                    <Viewbox Width="24" Height="24">
                                                        <Path Style="{StaticResource Icon}" Data="{StaticResource VectorCollection}" />
                                                    </Viewbox>
                                                </view:BulletItemControl.Header>
                                                <DockPanel>
                                                    <TextBlock Text="{Binding Version}" Margin="8 0" DockPanel.Dock="Right" VerticalAlignment="Center" TextAlignment="Right" />

                                                    <StackPanel Margin="0 0" VerticalAlignment="Center">
                                                        <TextBlock Style="{StaticResource DataHeader}" Text="{Binding DisplayPublisherName}" ToolTip="{Binding Publisher}" TextTrimming="CharacterEllipsis" />
                                                        <TextBlock Style="{StaticResource DataValue}" Text="{Binding DisplayName}" ToolTip="{Binding Name}" TextTrimming="CharacterEllipsis" />
                                                    </StackPanel>
                                                </DockPanel>
                                            </view:BulletItemControl>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>

                            </StackPanel>
                        </ScrollViewer>
                    </progressOverlay:ProgressOverlay>
                </TabItem>
                <TabItem Header="Installation" Visibility="{Binding SelectedPackageManifestInfo.HasError, Converter={StaticResource NegativeBooleanToVisibilityConverter}}">
                    <TabControl Margin="0 -7 0 0">
                        <TabItem Style="{StaticResource Compact}">
                            <TabItem.Header>
                                <TextBlock>
                            <Run Text="Modifications + Add-ons" />
                            <Run Text="{Binding SelectedPackageManifestInfo.CurrentValue.Addons.Count, Mode=OneWay}"  Foreground="#777" />
                                </TextBlock>
                            </TabItem.Header>
                            <progressOverlay:ProgressOverlay IsShown="{Binding SelectedPackageManifestInfo.IsLoading}">

                                <zeroOrAny:ZeroOrAny ItemsCount="{Binding SelectedPackageManifestInfo.CurrentValue.Addons.Count}">
                                    <zeroOrAny:ZeroOrAny.Template>
                                        <ControlTemplate TargetType="zeroOrAny:ZeroOrAny">
                                            <ContentControl Content="{Binding}" ContentTemplate="{TemplateBinding ActualTemplate}" />
                                        </ControlTemplate>
                                    </zeroOrAny:ZeroOrAny.Template>
                                    <zeroOrAny:ZeroOrAny.AnyItemTemplate>
                                        <DataTemplate>
                                            <ListBox 
                                                ItemsSource="{Binding SelectedPackageManifestInfo.CurrentValue.Addons}">
                                                <ListBox.ItemTemplate>
                                                    <DataTemplate DataType="{x:Type elements1:PackageContentDetailsViewModel}">
                                                        <DockPanel>
                                                            <Border DockPanel.Dock="Left" Background="#2B579A" Width="32" Height="32" VerticalAlignment="Center" HorizontalAlignment="Center">
                                                                <Border Background="{Binding TileColor}" Width="32" Height="32" VerticalAlignment="Center" HorizontalAlignment="Left">
                                                                    <Image Source="{Binding Logo, Mode=OneTime}" VerticalAlignment="Center" HorizontalAlignment="Center" MaxWidth="48" MaxHeight="48" Stretch="Uniform" StretchDirection="DownOnly" />
                                                                </Border>
                                                            </Border>

                                                            <StackPanel DockPanel.Dock="Right">
                                                                <TextBlock Text="{Binding Version, Mode=OneTime}" VerticalAlignment="Center" TextAlignment="Right" />
                                                            </StackPanel>

                                                            <StackPanel Margin="10 0">
                                                                <TextBlock TextTrimming="CharacterEllipsis">
                                                                    <Run Text="{Binding DisplayName, Mode=OneTime}" />
                                                                </TextBlock>
                                                                <TextBlock TextTrimming="CharacterEllipsis" Opacity="0.65">
                                                                    <Run Text="{Binding PublisherDisplayName, Mode=OneTime}" />
                                                                </TextBlock>
                                                            </StackPanel>

                                                        </DockPanel>
                                                    </DataTemplate>
                                                </ListBox.ItemTemplate>
                                            </ListBox>
                                        </DataTemplate>
                                    </zeroOrAny:ZeroOrAny.AnyItemTemplate>
                                    <zeroOrAny:ZeroOrAny.NoItemsTemplate>
                                        <DataTemplate>
                                            <msixHeroText:MsixHeroText VerticalAlignment="Center" Tag="This package has no installed add-ons or modification packages." />
                                        </DataTemplate>
                                    </zeroOrAny:ZeroOrAny.NoItemsTemplate>
                                </zeroOrAny:ZeroOrAny>
                            </progressOverlay:ProgressOverlay>
                        </TabItem>
                        <TabItem Style="{StaticResource Compact}">
                            <TabItem.Header>
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Visibility="{Binding SelectedPackageUsersInfo.CurrentValue.IsElevated, Converter={StaticResource BooleanToVisibilityConverter}}">
                                    <Run Text="Installed by" />
                                    <Run Text="{Binding SelectedPackageUsersInfo.CurrentValue.InstalledBy.Count, Mode=OneWay, FallbackValue=''}" Foreground="#777" />
                                    </TextBlock>
                                    <TextBlock Visibility="{Binding SelectedPackageUsersInfo.CurrentValue.IsElevated, Converter={StaticResource NegativeBooleanToVisibilityConverter}, FallbackValue=Collapsed}">
                                    <Run Text="Installed by" />
                                    </TextBlock>
                                </StackPanel>
                            </TabItem.Header>
                            <progressOverlay:ProgressOverlay IsShown="{Binding SelectedPackageUsersInfo.IsLoading}">
                                <Grid>
                                    <StackPanel Margin="8 0" VerticalAlignment="Center" Visibility="{Binding SelectedPackageUsersInfo.CurrentValue.IsElevated, Converter={StaticResource NegativeBooleanToVisibilityConverter}}">

                                        <TextBlock TextWrapping="Wrap" Text="In order to view who installed this package you must be an administrator." Margin="0 0 0 8" />
                                        <Button  DockPanel.Dock="Top" HorizontalAlignment="Left" Command="{Binding FindUsers}">
                                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                                <Image Source="{x:Static helpers:ShieldIcon.Source}" Width="{x:Static SystemParameters.SmallIconWidth}"  Height="{x:Static SystemParameters.SmallIconHeight}" VerticalAlignment="Center" Margin="0 0 4 0" />
                                                <TextBlock Text="Press here to query the packages as local administrator" VerticalAlignment="Center" />
                                            </StackPanel>
                                        </Button>
                                    </StackPanel>

                                    <ListBox Visibility="{Binding SelectedPackageUsersInfo.CurrentValue.IsElevated, Converter={StaticResource BooleanToVisibilityConverter}}" DisplayMemberPath="Name" Margin="0 0 0 0" ItemsSource="{Binding SelectedPackageUsersInfo.CurrentValue.InstalledBy}" />
                                </Grid>
                            </progressOverlay:ProgressOverlay>
                        </TabItem>
                    </TabControl>
                </TabItem>
            </TabControl>
        </DockPanel>
    </progressOverlay:ProgressOverlay>
</UserControl>
